View

・Top

Top
→
役割
アプリの説明

遷移先
Login

・ログイン関係

Login

役割
ログインフォーム

遷移先
index
callback→register（初回のソーシャルログインのみ）

リンク
Forgotpassword

Forgotpasswaord

役割
パスワードリセット用のリンクをメールで送信する。

フォーム
Email

Confirm Password

役割
パスワード再登録フォーム

フォーム
Email
password

遷移先
SuccessPassReset

SuccsessPassReset

役割
パスワードリセット完了の際のリダイレクト先。

遷移先
Login

・アプリ機能（必須枠）

Mypage

役割
ログイン後のTopページと各利用登録へのナビゲーション

実装する機能
予約をしている場合、その内容を一覧で表示する。

リンク
施設の利用登録
各施設の利用状況閲覧
登録の取り消し

SearchByDateReservation

役割
日時から施設の利用登録を行う

実装する機能
・プルダウンで年月日、利用時間帯を選択させる、できるならカレンダーからそれができるようにする。
・利用する施設を選択
（多目的ホール、議会所、レンタルスタジオといった感じ。最初は一種目にしておいてできたら増やす）
・検索機能（指定された年月日及び時間帯と施設をキーに検索する）





ResultByDateReservation

役割
検索結果の表示と利用登録の実行

実装する機能
・検索結果の一覧表示（index）
・検索結果ごとに検索した時間帯・申し込み件数・予約可能か否か（予約できるのならラジオボタンで選択できるようにする）
・検索機能（検索結果の変更で使う、カレンダーから選択できるようにするのが望ましい）
・予約の実行

挑戦枠
お気に入り機能

ConfirmByDateReservation

役割
予約内容の確認と確定

実装する機能
・ResultBy～からPostされた内容の表示（show）
・予約の確定登録）と修正ボタン
・確定をしたらDB登録とともにMypageへリダイレクトする。

ReservationIndex

役割
予約状況の一覧

実装する機能
・ユーザーに紐ついている予約状況をデータベースから取得して一覧表示する（index）
・利用日時・施設名・詳細内容ボタン（押すと詳細へ飛ぶ）

挑戦機能
利用日時から検索できるようにする。

ReservationDetail

役割
予約状況の詳細を表示する


利用日選択
・モデムなし、フォームから施設・利用したい日を受け取り・利用時間選択へ遷移

利用時間選択
・中心となる参照モデム→Reserve・Facility
Facilityテーブルから情報を受け取って、横軸に施設名・縦軸に2時間刻みの時間帯の一覧を出す。
次にフォームから受け取った情報を元にReserveを参照して、予約が入っている時間帯をブランクにする（start_timeを参照）
選択された箇所を施設名・利用時間の初めと終わりをセッションに保存する。

つまり、ブランクではないところには情報としては

・施設名、利用時間帯（startとendをそれぞれDatetime型で）

の3つが格納されているイメージ。

同一施設で選択された時間帯が一つだけだった場合、施設名・start・endをセッションに保存する。


同一施設で連番で取った場合は、施設名・利用時間帯1・利用時間帯2.....利用時間帯nとなり、利用時間帯1の初めと利用時間帯nの終わりを最終的に情報として得る。
つまり、施設名・利用時間1(start1、end1).....利用時間帯n(startn、endn)のうち、施設名・start1・endnをセッションに保存する。

同一施設で時間帯をまたぐように取った場合や違う施設も同時に予約した場合はそれぞれ別々の予約として処理する。
例えば、施設名・利用時間帯1・利用時間帯2とそこから飛んで利用時間帯5を取りたい場合は
施設名・start1・end2と施設名・start5・end5という2つの連想配列に情報を分けてセッションに保存しなければならないのでここで多次元配列を使う。

ex.
9時のみを選択した場合、start_timeは9時、end_timeは10時になるので、セッションには$start=9時、$end=10時となるように保存する。

同様に9時・10時・11時と選択した場合は9時と12時で保存する。

同じ施設で時間を跨ぐ場合や同時に違う施設の予約を取りたい場合は2つのセッション情報に分けて保存する例えば

9時～11時で選択した場合、施設名・9時・12時で予約情報のテーブルに保存される。
さらに同時に17時と18時を予約した場合、新たに施設名・17時・19時で予約情報のテーブルに保存されないといけないので別のセッション変数に分けて保存する。


確認画面
セッションに保存された情報から施設名・日時・開始・終了時間を取得して一覧表示する。
複数予約を取った場合はその分だけ表示する。
ログインユーザーの情報はAuthファザードをつかって取得する。

完了画面
reservesに情報を登録して、idにランダム英数字を結合したものを予約番号として控えさせる。
同時にメールでも予約番号を送る。（通知）


